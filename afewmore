#! /bin/bash

exit_with_error() {
    echo "ERROR:" $1
    exit 1
}

# main

# get options
OPTION_DIR="/data"
OPTION_NUM="10"
OPTION_VER=false
OPTION_HEL=false

NUM_ARGS=$#
if [[ $NUM_ARGS < 1 ]]; then
    exit_with_error "no instance specified"
fi

COUNT=$((NUM_ARGS-1))
PREV=""
for ARG in $@
do
    if [[ COUNT -lt 1 ]]; then
        break
    else
        ((COUNT--))
    fi

    if [[ $ARG == "-h" ]]; then
        OPTION_HEL=true
    elif [[ $ARG == "-v" ]]; then
        OPTION_VER=true
    elif [[ $PREV == "-d" ]]; then
        if [[ $(echo $ARG | egrep "^~?(\/[^\/]+)+$" | wc -m) > 0 ]]; then
            OPTION_DIR=$ARG
        else
            exit_with_error "invalid directory"
        fi
    elif [[ $PREV == "-n" ]]; then
        if [[ $(echo $ARG | egrep "^[0-9]+$" | wc -m) > 0 ]]; then
            OPTION_NUM=$ARG
        else
            exit_with_error "invalid number"
        fi
    elif [[ $ARG != "-n" && $ARG != "-d" ]]; then
        echo "unknown option \"$ARG\""
    fi

    PREV=$ARG
done
